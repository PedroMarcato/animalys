<ui:composition template="/WEB-INF/template/Layout.xhtml" xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html" xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets" xmlns:p="http://primefaces.org/ui" xmlns:o="http://omnifaces.org/ui">

	<f:metadata>
		<f:viewParam name="animal" value="#{consultaAnimalBean.animalSelecionado}" 
			converter="animalConverter" />
		<f:viewParam name="solicitacao" value="#{consultaAnimalBean.solicitacao}" />
		<f:viewAction action="#{consultaAnimalBean.inicializar}" />
	</f:metadata>
	<ui:define name="titulo">Consulta Clínica</ui:define>

	<ui:define name="content">
		<h:form id="form">
			<h1 class="aw-page-title">Consulta Clínica</h1>

			<p:messages id="msg" closable="true" />
			<p:toolbar>
				<p:toolbarGroup>
					<p:commandButton value="Salvar" icon="fa fa-save" id="botaoSalvar"
						action="#{consultaAnimalBean.salvar}" update="@form, eventDetails"
						disabled="#{consultaAnimalBean.atendido}" />
				</p:toolbarGroup>
				<p:toolbarGroup align="right">
					<p:button value="Pesquisa" icon="fa fa-search" outcome="/atendimento/newatendimento">
						<f:param name="solicitacao" value="#{consultaAnimalBean.solicitacao.idSolicitacao}" />
					</p:button>
				</p:toolbarGroup>
			</p:toolbar>

			<p:panelGrid columns="2" layout="grid" columnClasses="ui-grid-col-1, ui-grid-col-6"
				styleClass="panelgrid-noborder" style="margin-top: 10px">

				<p:outputLabel value="Animal: " style="font-weight: bold" />
				<p:outputLabel value="#{consultaAnimalBean.animalSelecionado.nome}" />
				<p:outputLabel value=" Espécie: " style="font-weight: bold" />
				<p:outputLabel value="#{consultaAnimalBean.animalSelecionado.raca.especie.nome}" />
				<p:outputLabel value=" Raça: " style="font-weight: bold" />
				<p:outputLabel value="#{consultaAnimalBean.animalSelecionado.raca.nome}" />
				<p:outputLabel value=" Sexo: " style="font-weight: bold" />
				<p:outputLabel value="#{consultaAnimalBean.animalSelecionado.sexo.descricao}" />
				<p:outputLabel value=" Idade: " style="font-weight: bold" />
				<p:outputLabel value="#{consultaAnimalBean.animalSelecionado.idade}" />

				<p:outputLabel value=" Cor: " style="font-weight: bold" />
				<p:outputLabel value="#{consultaAnimalBean.animalSelecionado.cor}" />

				<p:outputLabel value=" Microchip: " style="font-weight: bold" />
				<h:panelGroup>
					<p:outputLabel value="#{consultaAnimalBean.animalSelecionado.numeroMicrochip}" 
						rendered="#{not empty consultaAnimalBean.animalSelecionado.numeroMicrochip}" />
					<p:outputLabel value="Sem Microchip" 
						style="color: #999999; font-style: italic;"
						rendered="#{empty consultaAnimalBean.animalSelecionado.numeroMicrochip}" />
				</h:panelGroup>

				<p:outputLabel value=" Situação: " style="font-weight: bold" />
				<p:outputLabel value="#{consultaAnimalBean.animalSelecionado.status.descricao}" />

				<p:outputLabel value=" Solicitação: " style="font-weight: bold" />
				<p:outputLabel value="#{consultaAnimalBean.solicitacao.idSolicitacao}" />


			</p:panelGrid>
			<p:remoteCommand name="abrirDialogConsultaDuplicada" onstart="PF('dlgConsultaDuplicada').show();" />

			<p:dialog header="Confirmação de Atendimento Duplicado" widgetVar="dlgConsultaDuplicada" modal="true"
				closable="false" visible="#{consultaAnimalBean.mostrarConfirmacaoConsultaDuplicada}">
				<h:outputText
					value="Este animal já foi atendido hoje. Deseja realmente realizar outra consulta para este animal?" />
				<br /><br />
				<p:commandButton value="Sim, continuar" icon="fa fa-check"
					action="#{consultaAnimalBean.confirmarConsultaDuplicada}"
					oncomplete="PF('dlgConsultaDuplicada').hide();" update="@form" />
				<p:commandButton value="Cancelar" icon="fa fa-close"
					onclick="PF('dlgConsultaDuplicada').hide(); window.history.back(); return false;" />
			</p:dialog>

			<p:tabView id="tabView1">

				<p:tab title="Dados da Consulta">
					<p:panelGrid columns="2" id="painelDadosConsulta" layout="grid"
						columnClasses="ui-grid-col-2,ui-grid-col-10" styleClass="panelgrid-noborder">


						<p:outputLabel value="Escore Corporal:" for="escoreCorporal" />
						<p:inputNumber id="escoreCorporal" value="#{consultaAnimalBean.atendimento.escoreCorporal}"
							readonly="#{consultaAnimalBean.atendido}" decimalPlaces="1" placeholder=" " />

						<p:outputLabel value="Peso (kg):" for="peso" />
						<p:inputNumber id="peso" value="#{consultaAnimalBean.atendimento.peso}"
							readonly="#{consultaAnimalBean.atendido}" decimalPlaces="2" minValue="0" />

						<p:outputLabel value="FC (bpm):" for="fc" />
						<p:inputNumber id="fc" value="#{consultaAnimalBean.atendimento.fc}"
							readonly="#{consultaAnimalBean.atendido}" decimalPlaces="0" minValue="0" />

						<p:outputLabel value="FR (irpm):" for="fr" />
						<p:inputNumber id="fr" value="#{consultaAnimalBean.atendimento.fr}"
							readonly="#{consultaAnimalBean.atendido}" decimalPlaces="0" minValue="0" />

						<p:outputLabel value="Temperatura (°C):" for="temperatura" />
						<p:inputNumber id="temperatura" value="#{consultaAnimalBean.atendimento.temperatura}"
							readonly="#{consultaAnimalBean.atendido}" decimalPlaces="1" placeholder=" " />

						<p:outputLabel value="Profissional:" for="profissional" />
						<p:selectOneMenu id="profissional" value="#{consultaAnimalBean.profissionalSelecionado}"
							disabled="#{consultaAnimalBean.atendido}" required="true" 
							requiredMessage="O profissional deve ser selecionado">
							<f:selectItem itemLabel="Selecione o profissional" itemValue="#{null}" />
							<f:selectItems value="#{consultaAnimalBean.profissionaisSelect}" var="prof"
								itemLabel="#{prof.nome}" itemValue="#{prof}" />
						</p:selectOneMenu>
						
						<p:outputLabel value="" />
						<p:message for="profissional" display="text" />

						<p:outputLabel value="Tratamento:" for="tratamento" />
						<p:selectOneMenu id="tratamento" value="#{consultaAnimalBean.atendimento.tratamento}"
							disabled="#{consultaAnimalBean.atendido}" converter="omnifaces.SelectItemsConverter">
							<f:selectItem itemLabel="Selecione" itemValue="" />
							<f:selectItems value="#{consultaAnimalBean.tratamentos}" var="trat" itemLabel="#{trat.nome}"
								itemValue="#{trat}" />
						</p:selectOneMenu>
					</p:panelGrid>
				</p:tab>

				<p:tab title="Sinais Clínicos/Tratamento">

					<p:panelGrid columns="1" id="painel" layout="grid" columnClasses="ui-grid-col-12"
						styleClass="panelgrid-noborder">

						<p:textEditor id="parecer" widgetVar="editor1"
							value="#{consultaAnimalBean.atendimento.diagnostico}" height="300"
							style="margin-bottom:10px" rendered="true" required="true"
							requiredMessage="Informe o parecer!" readonly="#{consultaAnimalBean.atendido}" />

					</p:panelGrid>
				</p:tab>

				<p:tab title="Microchip">

					<p:panelGrid columns="2" id="painelMicro" layout="grid"
						columnClasses="ui-grid-col-2, ui-grid-col-2"
						styleClass="panelgrid-noborder">

						<p:outputLabel value="Informe o Nº do microchip:" for="microchip" />

						<p:inputText id="microchip"
							value="#{consultaAnimalBean.animalSelecionado.numeroMicrochip}"
							readonly="#{consultaAnimalBean.atendido}" />

					</p:panelGrid>
				</p:tab>

				<p:tab title="Agendar Castração"
					rendered="#{consultaAnimalBean.animalSelecionado.status.name() ne 'CASTRADO'}">

					<p:schedule id="scheduleLocale" value="#{consultaAnimalBean.eventModel}" locale="pt"
						timeZone="GMT-3" resizable="true" timeFormat="HH:mm" style="margin-top: 20px; width: 800px">

						<p:ajax event="dateSelect" listener="#{consultaAnimalBean.onDateSelect}"
							update=":form:eventDetails" oncomplete="PF('eventDialog').show();" />

						<p:ajax event="eventSelect" listener="#{consultaAnimalBean.onEventSelect}"
							update=":form:eventDetails2" oncomplete="PF('eventDialog2').show();" />

					</p:schedule>
				</p:tab>

				<p:tab title="Atendimentos anteriores" rendered="#{consultaAnimalBean.temAtendimentoAnterior}">
					<p:accordionPanel var="anterior" value="#{consultaAnimalBean.atendimentosAnteriores}">
						<p:tab title="#{anterior.dataAtendimentoFormatada} - #{anterior.profissional.nome}">
							<h:panelGrid columns="2" cellpadding="10">
								<p:outputLabel value="Tipo de Atendimento:" style="font-weight: bold" />
								<h:panelGroup>
									<p:outputLabel value="CONSULTA" 
										rendered="#{anterior.tipoAtendimento eq null or anterior.tipoAtendimento eq 'CONSULTA'}" />
									<p:outputLabel value="CASTRAÇÃO" 
										rendered="#{anterior.tipoAtendimento eq 'CASTRACAO'}" />
								</h:panelGroup>

								<p:outputLabel value="Procedimento:" style="font-weight: bold" 
									rendered="#{anterior.tipoAtendimento eq 'CASTRACAO'}" />
								<h:panelGroup rendered="#{anterior.tipoAtendimento eq 'CASTRACAO'}">
									<p:outputLabel value="#{anterior.procedimentos[0].nome}" 
										rendered="#{not empty anterior.procedimentos and not empty anterior.procedimentos[0].nome}" />
									<p:outputLabel value="Sem Registros" 
										style="color: #999999; font-style: italic;"
										rendered="#{empty anterior.procedimentos or empty anterior.procedimentos[0].nome}" />
								</h:panelGroup>

								<p:outputLabel value="Sinais Clínicos/Tratamento:" style="font-weight: bold" />
								<h:panelGroup>
									<p:outputLabel value="#{anterior.diagnostico}" escape="false" 
										rendered="#{not empty anterior.diagnostico}" />
									<p:outputLabel value="Sem Registros" 
										style="color: #999999; font-style: italic;"
										rendered="#{empty anterior.diagnostico}" />
								</h:panelGroup>

								<p:outputLabel value="Escore Corporal:" style="font-weight: bold" />
								<h:panelGroup>
									<p:outputLabel value="#{anterior.escoreCorporal}" 
										rendered="#{not empty anterior.escoreCorporal}" />
									<p:outputLabel value="Sem Registros" 
										style="color: #999999; font-style: italic;"
										rendered="#{empty anterior.escoreCorporal}" />
								</h:panelGroup>

								<p:outputLabel value="Peso:" style="font-weight: bold" />
								<h:panelGroup>
									<p:outputLabel value="#{anterior.peso} kg" 
										rendered="#{not empty anterior.peso}" />
									<p:outputLabel value="Sem Registros" 
										style="color: #999999; font-style: italic;"
										rendered="#{empty anterior.peso}" />
								</h:panelGroup>

								<p:outputLabel value="FC:" style="font-weight: bold" />
								<h:panelGroup>
									<p:outputLabel value="#{anterior.fc} bpm" 
										rendered="#{not empty anterior.fc}" />
									<p:outputLabel value="Sem Registros" 
										style="color: #999999; font-style: italic;"
										rendered="#{empty anterior.fc}" />
								</h:panelGroup>

								<p:outputLabel value="FR:" style="font-weight: bold" />
								<h:panelGroup>
									<p:outputLabel value="#{anterior.fr} irpm" 
										rendered="#{not empty anterior.fr}" />
									<p:outputLabel value="Sem Registros" 
										style="color: #999999; font-style: italic;"
										rendered="#{empty anterior.fr}" />
								</h:panelGroup>

								<p:outputLabel value="Temperatura:" style="font-weight: bold" />
								<h:panelGroup>
									<p:outputLabel value="#{anterior.temperatura} °C" 
										rendered="#{not empty anterior.temperatura}" />
									<p:outputLabel value="Sem Registros" 
										style="color: #999999; font-style: italic;"
										rendered="#{empty anterior.temperatura}" />
								</h:panelGroup>

								<p:outputLabel value="Tratamento:" style="font-weight: bold" />
								<h:panelGroup>
									<p:outputLabel value="#{anterior.tratamento.nome}" 
										rendered="#{not empty anterior.tratamento and not empty anterior.tratamento.nome}" />
									<p:outputLabel value="Sem Registros" 
										style="color: #999999; font-style: italic;"
										rendered="#{empty anterior.tratamento or empty anterior.tratamento.nome}" />
								</h:panelGroup>

								<p:outputLabel value="Responsável:" style="font-weight: bold" />
								<h:panelGroup>
									<p:outputLabel value="#{anterior.profissional.nome}" 
										rendered="#{not empty anterior.profissional and not empty anterior.profissional.nome}" />
									<p:outputLabel value="Sem Registros" 
										style="color: #999999; font-style: italic;"
										rendered="#{empty anterior.profissional or empty anterior.profissional.nome}" />
								</h:panelGroup>

								<p:outputLabel value="Situação:" style="font-weight: bold" />
								<p:outputLabel value="FINALIZADO" />

								<p:outputLabel value="Data para Castração:" style="font-weight: bold" />
								<h:panelGroup>
									<p:outputLabel value="#{anterior.animal.dataAgendaCastracao.time}"
										rendered="#{not empty anterior.animal.dataAgendaCastracao}">
										<f:convertDateTime locale="pt" pattern="dd/MM/yyyy HH:mm" type="date" />
									</p:outputLabel>
									<p:outputLabel value="Sem Registros" 
										style="color: #999999; font-style: italic;"
										rendered="#{empty anterior.animal.dataAgendaCastracao}" />
								</h:panelGroup>

								<p:outputLabel value="Medicamentos Utilizados:" style="font-weight: bold" />
								<p:dataTable id="medicamentosFeitos" style="margin-top: 20px"
									emptyMessage="Nenhum medicamento adicionado!" rows="10" reflow="true"
									value="#{anterior.itemLoteAtendimento}" var="item">
									<p:column headerText="Medicamento">
										<h:outputText value="#{item.lote.produto.nome}" />
									</p:column>
									<p:column headerText="Quantidade">
										<h:outputText value="#{item.quantidade}" />
									</p:column>
									<p:column headerText="Lote">
										<h:outputText value="#{item.lote.numeroLote}" />
									</p:column>
									<p:column headerText="Validade">
										<h:outputText value="#{item.lote.validadeFormatada}" />
									</p:column>

								</p:dataTable>

							</h:panelGrid>
						</p:tab>
					</p:accordionPanel>
				</p:tab>
			</p:tabView>

			<p:dialog widgetVar="eventDialog" header="Agendar Castração" showEffect="clip" hideEffect="clip">
				<h:panelGrid id="eventDetails" columns="2">

					<p:outputLabel for="from" value="Data:" />
					<p:calendar id="from" mask="99/99/9999 99:99" value="#{consultaAnimalBean.event.startDate}"
						pattern="dd/MM/yyyy HH:mm" locale="pt" />

					<p:commandButton value="Salvar" icon="fa fa-check" oncomplete="PF('eventDialog').hide();"
						action="#{consultaAnimalBean.adicionaCastracao}" update="@form"
						disable="#{consultaAnimalBean.atendido}" />
				</h:panelGrid>
			</p:dialog>

			<p:dialog widgetVar="eventDialog2" header="Agendamendo da visita clínica" showEffect="clip"
				hideEffect="clip">
				<h:panelGrid id="eventDetails2" columns="2">

					<p:outputLabel value="Proprietário:" style="font-weight: bold" />

					<p:outputLabel value="#{consultaAnimalBean.animalSelecionadoSchedule.proprietario.nome}" />

					<p:outputLabel value="Animal:" style="font-weight: bold" />

					<p:outputLabel value="#{consultaAnimalBean.animalSelecionadoSchedule.nome}" />

					<p:outputLabel value="Data para castração:" style="font-weight: bold" />

					<p:outputLabel value="#{consultaAnimalBean.animalSelecionadoSchedule.dataAgendaCastracao.time}">
						<f:convertDateTime type="date" locale="pt" pattern="dd/MM/yyyy HH:mm" />
					</p:outputLabel>

				</h:panelGrid>
			</p:dialog>

		</h:form>
	</ui:define>
</ui:composition>