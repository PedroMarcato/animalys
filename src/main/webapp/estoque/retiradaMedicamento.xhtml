<ui:composition template="/WEB-INF/template/Layout.xhtml"
	xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui">

	<ui:define name="titulo">Retirada de Medicamentos</ui:define>
	<f:metadata>
		<f:viewAction action="#{retiradaMedicamentoBean.inicializar()}" />
	</f:metadata>
	
	<ui:define name="content">
		<h:form id="formRetirada">
			<h1 class="aw-page-title">Retirada de Medicamentos</h1>

			<p:messages id="messages" closable="true" />
			
			<p:toolbar>
				<p:toolbarGroup>
					<p:button value="Nova Retirada" icon="fa fa-plus"
						outcome="/estoque/retiradaMedicamento" />
					<p:commandButton value="Salvar" icon="fa fa-save"
						action="#{retiradaMedicamentoBean.salvar()}" 
						update="@form" />
					<p:commandButton value="Limpar" icon="fa fa-eraser"
						action="#{retiradaMedicamentoBean.limpar()}" 
						update="@form" immediate="true" />
				</p:toolbarGroup>
				<p:toolbarGroup align="right">
					<p:button value="Pesquisar Retiradas" icon="fa fa-search"
						outcome="/estoque/pesquisaRetiradaMedicamento" />
				</p:toolbarGroup>
			</p:toolbar>

			<div class="ui-fluid">
				<p:panelGrid columns="4" layout="grid"
					columnClasses="ui-grid-col-2, ui-grid-col-4, ui-grid-col-2, ui-grid-col-4"
					styleClass="panelgrid-noborder" style="margin-top: 20px">

					<p:outputLabel value="CPF do Proprietário" for="cpfProprietario" />
					<h:panelGroup>
						<p:inputMask id="cpfProprietario" mask="999.999.999-99"
							value="#{retiradaMedicamentoBean.cpfProprietario}"
							placeholder="Digite o CPF do proprietário" required="true">
							<p:ajax event="blur" 
								listener="#{retiradaMedicamentoBean.buscarProprietarioPorCpf()}" 
								update="nomeProprietario animalSelect messages" />
						</p:inputMask>
						<p:message for="cpfProprietario" />
					</h:panelGroup>

					<p:outputLabel value="Proprietário" for="nomeProprietario" />
					<p:inputText id="nomeProprietario"
						value="#{retiradaMedicamentoBean.retirada.proprietario.nome}"
						readonly="true" 
						placeholder="Proprietário será carregado após inserir CPF" />

					<p:outputLabel value="Animal" for="animalSelect" />
					<h:panelGroup>
						<p:selectOneMenu id="animalSelect"
                            required="true"
							value="#{retiradaMedicamentoBean.retirada.animal}"
							converter="animalConverter"
							disabled="#{empty retiradaMedicamentoBean.animaisProprietario}">
							<f:selectItem itemLabel="Selecione o animal" noSelectionOption="true" />
							<f:selectItems value="#{retiradaMedicamentoBean.animaisProprietario}"
								var="animal" 
								itemValue="#{animal}" 
								itemLabel="#{animal.nome} - #{animal.raca != null ? animal.raca.nome : 'Sem raça'}" />
							<p:ajax event="change" update="racaAnimal classificacaoIdade" />
						</p:selectOneMenu>
						<p:message for="animalSelect" />
					</h:panelGroup>

					<p:outputLabel value="Raça" for="racaAnimal" />
					<p:inputText id="racaAnimal"
						value="#{retiradaMedicamentoBean.retirada.animal != null and retiradaMedicamentoBean.retirada.animal.raca != null ? retiradaMedicamentoBean.retirada.animal.raca.nome : 'Não informada'}"
						readonly="true" 
						placeholder="Raça será exibida após selecionar o animal" />

					<p:outputLabel value="Classificação Etária" for="classificacaoIdade" />
					<p:inputText id="classificacaoIdade"
						value="#{retiradaMedicamentoBean.classificacaoIdade}"
						readonly="true" 
						placeholder="Classificação será exibida após selecionar o animal" />

					<p:outputLabel value="Medicamento" for="nomeMedicamento" />
					<h:panelGroup>
						<p:inputText id="nomeMedicamento"
							value="#{retiradaMedicamentoBean.retirada.nomeMedicamento}"
                            required="true"
							placeholder="Digite o nome do medicamento"
							maxlength="200" />
						<p:message for="nomeMedicamento" />
					</h:panelGroup>

					<p:outputLabel value="Quantidade" for="quantidade" />
					<h:panelGroup>
						<p:spinner id="quantidade"
                            required="true"
							value="#{retiradaMedicamentoBean.retirada.quantidade}"
							min="1"
							max="999" />
						<p:message for="quantidade" />
					</h:panelGroup>

					<p:outputLabel value="Data da Retirada" for="dataRetirada" />
					<h:panelGroup>
						<p:calendar id="dataRetirada"
                            required="true"
							value="#{retiradaMedicamentoBean.dataRetirada}"
							pattern="dd/MM/yyyy HH:mm"
							showTime="true"
							timeOnlyTitle="Escolha o horário"
							stepHour="1"
							stepMinute="15"
							locale="pt_BR" />
						<p:message for="dataRetirada" />
					</h:panelGroup>

				</p:panelGrid>

				<p:panelGrid columns="1" layout="grid"
					columnClasses="ui-grid-col-12"
					styleClass="panelgrid-noborder" style="margin-top: 10px">
					
					<p:outputLabel value="Observações" for="observacoes" />
					<p:inputTextarea id="observacoes"
						value="#{retiradaMedicamentoBean.retirada.observacoes}"
						rows="3"
						maxlength="500"
						placeholder="Observações sobre a retirada do medicamento (opcional)"
                        style="height: 400px;" />
				
				</p:panelGrid>

			</div>
		</h:form>
	</ui:define>

</ui:composition>