<ui:composition template="/WEB-INF/template/Layout.xhtml"
	xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui">

	<ui:define name="titulo">Retirada de Ração</ui:define>
	<f:metadata>
		<f:viewAction action="#{retiradaRacaoBean.inicializar()}" />
	</f:metadata>
	
	<ui:define name="content">
		<h:form id="formRetirada">
			<h1 class="aw-page-title">
				#{empty retiradaRacaoBean.retirada.idRetiradaRacao ? 'Nova Retirada de Ração' : 'Editar Retirada de Ração'}
			</h1>

			<p:messages id="messages" closable="true" />
			
			<p:toolbar>
				<p:toolbarGroup>
					<p:button value="Nova Retirada" icon="fa fa-plus"
						outcome="/estoque/retiradaRacao" />
					<p:commandButton value="Salvar" icon="fa fa-save"
						action="#{retiradaRacaoBean.salvar()}" 
						update="@form" />
					<p:commandButton value="Limpar" icon="fa fa-eraser"
						action="#{retiradaRacaoBean.limpar()}" 
						update="@form" immediate="true" />
				</p:toolbarGroup>
				<p:toolbarGroup align="right">
					<p:button value="Pesquisar Retiradas" icon="fa fa-search"
						outcome="/estoque/pesquisaRetiradaRacao" />
				</p:toolbarGroup>
			</p:toolbar>

			<div class="ui-fluid">
				<p:panelGrid columns="4" layout="grid"
					columnClasses="ui-grid-col-2, ui-grid-col-4, ui-grid-col-2, ui-grid-col-4"
					styleClass="panelgrid-noborder" style="margin-top: 20px">

					<p:outputLabel value="CPF do Proprietário" for="cpfProprietario" />
					<h:panelGroup>
						<p:inputMask id="cpfProprietario" mask="999.999.999-99"
							value="#{retiradaRacaoBean.cpfProprietario}"
							placeholder="Digite o CPF do proprietário" required="true">
							<p:ajax event="blur" 
								listener="#{retiradaRacaoBean.buscarProprietarioPorCpf()}" 
								update="nomeProprietario animalSelect messages" />
						</p:inputMask>
						<p:message for="cpfProprietario" />
					</h:panelGroup>

					<p:outputLabel value="Proprietário" for="nomeProprietario" />
					<p:inputText id="nomeProprietario"
						value="#{retiradaRacaoBean.retirada.proprietario.nome}"
						readonly="true" 
						placeholder="Proprietário será carregado após inserir CPF" />

					<p:outputLabel value="Animal" for="animalSelect" />
					<h:panelGroup>
						<p:selectOneMenu id="animalSelect"
                            required="true"
							value="#{retiradaRacaoBean.animalSelecionadoId}"
							disabled="#{empty retiradaRacaoBean.animaisProprietario}">
							<f:selectItem itemLabel="Selecione o animal" itemValue="#{null}" noSelectionOption="true" />
							<f:selectItems value="#{retiradaRacaoBean.animaisProprietario}"
								var="animal" 
								itemValue="#{animal.idAnimal}" 
								itemLabel="#{animal.nome} - #{animal.raca != null ? animal.raca.nome : 'Sem raça'}" />
							<p:ajax event="change" update="racaAnimal classificacaoIdade" />
						</p:selectOneMenu>
						<p:message for="animalSelect" />
					</h:panelGroup>

					<p:outputLabel value="Raça" for="racaAnimal" />
					<p:inputText id="racaAnimal"
						value="#{retiradaRacaoBean.retirada.animal != null and retiradaRacaoBean.retirada.animal.raca != null ? retiradaRacaoBean.retirada.animal.raca.nome : 'Não informada'}"
						readonly="true" 
						placeholder="Raça será exibida após selecionar o animal" />

					<p:outputLabel value="Classificação Etária" for="classificacaoIdade" />
					<p:inputText id="classificacaoIdade"
						value="#{retiradaRacaoBean.classificacaoIdade}"
						readonly="true" 
						placeholder="Classificação será exibida após selecionar o animal" />

					<p:outputLabel value="Quantidade (Kg)" for="quantidadeKg" />
					<h:panelGroup>
						<p:spinner id="quantidadeKg"
                            required="true"
							value="#{retiradaRacaoBean.retirada.quantidadeKg}"
							min="0.001"
							max="999.999"
							step="0.5"
							decimalPlaces="3"
							placeholder="Ex: 5.000" />
						<p:message for="quantidadeKg" />
					</h:panelGroup>

					<p:outputLabel value="Mês de Referência" for="mesReferencia" />
					<h:panelGroup>
						<p:selectOneMenu id="mesReferencia"
                            required="true"
							value="#{retiradaRacaoBean.retirada.mesReferencia}">
							<f:selectItem itemLabel="Selecione o mês" noSelectionOption="true" />
							<f:selectItems value="#{retiradaRacaoBean.mesesReferencia}"
								var="mes" 
								itemValue="#{mes.numero}" 
								itemLabel="#{mes.numero} - #{mes.nome}" />
						</p:selectOneMenu>
						<p:message for="mesReferencia" />
					</h:panelGroup>

					<p:outputLabel value="Data da Retirada" for="dataRetirada" />
					<h:panelGroup>
						<p:calendar id="dataRetirada"
                            required="true"
							value="#{retiradaRacaoBean.dataRetirada}"
							pattern="dd/MM/yyyy HH:mm"
							showTime="true"
							timeOnlyTitle="Escolha o horário"
							stepHour="1"
							stepMinute="15"
							locale="pt_BR" />
						<p:message for="dataRetirada" />
					</h:panelGroup>

				</p:panelGrid>

				<p:panelGrid columns="1" layout="grid"
					columnClasses="ui-grid-col-12"
					styleClass="panelgrid-noborder" style="margin-top: 10px">
					
					<p:outputLabel value="Observações" for="observacoes" />
					<p:inputTextarea id="observacoes"
						value="#{retiradaRacaoBean.retirada.observacoes}"
						rows="3"
						maxlength="500"
						placeholder="Observações sobre a retirada da ração (opcional)" />
				
				</p:panelGrid>

			</div>
		</h:form>
	</ui:define>

</ui:composition>